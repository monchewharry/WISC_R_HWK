---
title: "hwk3"
author: "Dingxian Cao"
date: "October 29, 2015"
output: html_document
---

# 5  

```{r}
n=100#sample size
dat<- data.frame(x1=rnorm(n,3,2),x2=rexp(n,1),x3=rgamma(n,2,3)) 
betaT<-c(beta0=2,beta1=1.2,beta2=-1.4,beta3=-0.5)
muT<-as.vector(model.matrix(~x1+x2+x3,dat) %*% betaT)#EY  

sigmasq<-runif(n,0.5,3)#variance
sigma<-sqrt(sigmasq)
yy<- muT+sigma*rnorm(n)# ONE realization  with different variance
lm(yy~.,data=dat)  
lm(yy~.,data=dat,weights = 1/sigmasq)

S<-10000 #simulation realization number
YY<- muT + sigma * matrix(rnorm(n * S), nrow = n,ncol = S)

beta_diff<-function(y){
  lmi<-lm(y~.,data = dat)
  wlmi<-lm(y~.,data = dat,weights = 1/sigmasq)
  c(lmi$coefficients-betaT,wlmi$coefficients-betaT)
}
beta_dif<-apply(YY, 2,beta_diff)

beta_dif_lm<-beta_dif[1:4,]
beta_dif_wlm<-beta_dif[5:8,]

rowMeans(beta_dif_lm^2)#beta mse OF OLS
rowMeans(beta_dif_wlm^2)#beta mse OF WLS
```



# 6

```{r}
ants <- read.table("thatch_ant_c5del.txt", sep='', header=TRUE)
pairs(ants)
library(lattice)
splom(ants)
```

>There is no explicit relationship between Headwidth and colony or distance.  

```{r}
ants2<-read.table("thatch_ant_c5del.txt", sep='', header=TRUE,
                  colClasses = c("factor","numeric","numeric","numeric","numeric"))
#should take colony number as factor  

str(ants2)
result<-lm(Headwidth~0+Colony+Distance,data = ants2)
summary(result)
```

```{r}
design<-model.matrix(~Colony+Distance-1,data = ants2)
dim(design)
design[design[,11]==4
       ,colnames(design)=="Colony4"]
```

> the coefficients of the each colony means the average headwidth in that colony at distance 0. And the coefficient of distance means that the average headwidth will grow 0.167 per meter.

```{r}
m1<-lm(Headwidth~Colony+Distance-1,data = ants2)
m2<-lm(Headwidth~1,data = ants2)
anova(m1,m2)
```

>H0: beta1.=beta2=0  
>test statistic= $F=\frac{(RSS2-RSS1)/11}{RSS1/(1104-11)}=5.47646$. it's distribution is F(11,1093), the result is to reject the Null hypothesis which means headwidth is related to colony and distance.   

```{r}
m1<-lm(Headwidth~Colony+Distance-1,data = ants2)
m2<-lm(Headwidth~Colony-1,data = ants2)
anova(m1,m2)
```

>H0: beta2=0  
>test statistic= $F=\frac{(RSS2-RSS1)/1}{RSS1/(1104-11)}=18.83143$. it's distribution is F(1,1093), the result is to reject the Null hypothesis which means headwidth is related to distance.   


```{r}
library(car)
library(lme4)
m1<-lm(Headwidth~Colony+Distance-1,data = ants2)
m1$coefficients
rhs <- rep(0,9)
hm<-rbind(c(0,1,0,0,0,0,0,0,-1,0,0)
          ,c(1,-2,0,0,0,0,0,0,0,0,0)
          ,c(0,-2,1,0,0,0,0,0,0,0,0)
          ,c(0,-2,0,1,0,0,0,0,0,0,0)
          ,c(0,-2,0,0,1,0,0,0,0,0,0)
          ,c(0,-2,0,0,0,1,0,0,0,0,0)
          ,c(0,-2,0,0,0,0,1,0,0,0,0)
          ,c(0,-2,0,0,0,0,0,1,0,0,0)
          ,c(0,-2,0,0,0,0,0,0,0,1,0))
linear.hypothesis(m1,hm,rhs)
```

















